<div id="scope">
  <h2>
    Record decision
    <br/>
    <small>
      <% if @need.out_of_scope? %>
        <strong>This need is not in scope for GOV.UK</strong>
        <br/>
        <%= @need.out_of_scope_reason %>
      <% elsif @need.duplicate? %>
        You can't mark this need as 'out of scope' because it's already closed as a duplicate
      <% else %>
        Define whether this need is valid or not
      <% end %>
    </small>
  </h2>
  <% if @need.duplicate? %>
    <%= link_to "Record decision",
                "#",
                id: 'out-of-scope',
                disabled: "",
                class: "btn btn-default btn-disabled" %>
  <% else %>
    <%= link_to "Record decision",
                out_of_scope_need_path(@need),
                id: 'out-of-scope',
                class: "btn btn-danger" %>
  <% end %>
</div>

<script>
  $('#out-of-scope').
  attr('href', '#out-of-scope-modal').
  attr('data-toggle', 'modal').
  attr('role', 'button')
</script>

<% unless @need.out_of_scope? %>
  <div id="out-of-scope-modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="modal-out-of-scope-label" aria-hidden="true">
    <div class="modal-dialog">
      <%= semantic_form_for @need, { url: descope_need_path(@need), html: { class: "modal-content" } } do |f| %>
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          <h3 id="modal-record-decision-label" class="modal-title">Record decision about the need</h3>
        </div>
        <div class="modal-body">
          <%= f.input :status,
                      :label => "Mark this need as:",
                      :input_html => { class: "new-status" },
                      :as => :radio,
                      :collection => {
                        "valid - it’s good for a content designer to work with on a content plan" => "status-valid",
                        "valid with conditions - there are some minor questions or requests for clarity" => "status-valid-with-conditions",
                        "not valid - the need is badly formed, lacks detail, or is out of proposition" => "status-invalid",
                      } %>
          <div class="optional-question status-valid">
            <%= f.input :out_of_scope_reason,
                        :label => "Additional comments (optional)",
                        :as => :text,
                        :input_html => { :rows => 3 } %>
          </div>
          <div class="optional-question status-valid-with-conditions">
            <%= f.input :validation_conditions,
                        :label => "What needs to change before the need is valid?",
                        :hint => "Please list any points that need to be clarified",
                        :as => :text,
                        :input_html => { :rows => 3 } %>
          </div>
          <div class="optional-question status-invalid">
            <p>Why is this need invalid?</p>
            <%= f.input :reasons_why_invalid,
                        :label => "This need:",
                        :as => :check_boxes,
                        :collection => {
                          "has typos or acronyms that aren't defined" => "errors_typos",
                          "is incomplete or imprecise (eg user, acceptance criteria)" => "incomplete",
                          "contains sensitive or politically controversial information" => "sensitive",
                          "is an organisational need or isn't properly defined as a user need" => "org_need",
                          "is an acceptance criterion of another need" => "ac_of_another_need",
                          "is invalid or not in proposition" => "not_in_prop",
                        } %>
            <%= f.input :other_reasons_why_invalid,
                        :label => "Any other reason why the need is invalid (optional)",
                        :as => :text,
                        :input_html => { :rows => 3 } %>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>
          <%= f.action :submit,
                       :method => :put,
                       :button_html => {
                         :value => "Record decision",
                         :class => "btn btn-danger"
                       }
                     %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
